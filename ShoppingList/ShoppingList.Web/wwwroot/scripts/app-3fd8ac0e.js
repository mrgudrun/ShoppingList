"use strict";angular.module("app.login",[]).factory("authenticationService",["$base64","$http","$cookieStore","$rootScope","$timeout","loggedInUserFactory",function(e,o,n,a,r,t){var i={};return i.Login=function(e,r,i){o.post("/api/user/login",{username:e,password:r}).success(function(e){i(e),a.globals.currentUser.id=e.UserId,n.put("globals",a.globals),t.refresh()}).error(function(e){i(e)})},i.SetCredentials=function(r,t){var i=e.encode(r+":"+t);a.globals={currentUser:{username:r,authdata:i}},o.defaults.headers.common.Authorization="Basic "+i,n.put("globals",a.globals)},i.ClearCredentials=function(){a.globals={},n.remove("globals"),o.defaults.headers.common.Authorization="Basic "},i}]),angular.module("app.login").controller("LoginController",["$scope","$rootScope","$location","authenticationService","loggedInUserFactory",function(e,o,n,a){a.ClearCredentials(),e.login=function(){e.dataLoading=!0,a.Login(e.username,e.password,function(o){o.Success?(a.SetCredentials(e.username,e.password),n.path("/index/main")):(e.error=o.Message,e.dataLoading=!1)})}}]),angular.module("app.login").factory("loggedInUserFactory",["personFactory","$rootScope",function(e,o){var n=this;return n.refresh=function(a){void 0!==o.globals&&void 0!==o.globals.currentUser&&(n.id=o.globals.currentUser.id,void 0===n.name&&e.get({id:n.id}).$promise.then(function(e){n.name=e.FirstName+" "+e.SurName,n.address=e.Address,n.telephone=e.Telephone,n.email=e.Email,n.officeIds=e.OfficeIds,void 0!==a&&a()}))},n.refresh(),n}]),angular.module("app",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,o){e.state("login",{url:"/login",templateUrl:"app/login/login.html",data:{pageTitle:"Login"}}).state("signUp",{url:"/signUp",templateUrl:"app/signUp/signUp.html"}).state("index.main",{url:"/main",templateUrl:"app/main/main.html"}),o.otherwise("/login")}]),angular.module("app").run(["$templateCache",function(e){e.put("app/login/login.html",'<div class="container" ng-app="app.login" ng-controller="LoginController"><div><form name="form" class="m-t" role="form" ng-submit="login()"><h2 class="form-signin-heading">Please sign in</h2><input type="text" ng-model="username" class="form-control" placeholder="Username" required="" autofocus=""> <input type="password" ng-model="password" class="form-control" placeholder="Password" required=""><div class="checkbox"><label><input type="checkbox" value="remember-me"> Remember me</label></div><button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button></form></div></div>'),e.put("app/main/main.html","<div>Sup world!?</div>"),e.put("app/signUp/signUp.html","<div><h1>SignUp</h1></div>")}]);